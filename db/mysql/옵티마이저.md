<!-- @format -->

# 옵티마이저

-   쿼리는 결과는 동일, 내부적으로 그 결과를 만들어내는 방법은 매우 다양하다.

-   최적, 최소 비용의 방법을 결정해야 한다.

-   각 테이블의 데이터가 어떤 분포로 저장돼 있는지 통계 정보를 참조하며, 그러한 기본 데이터를 비교해 최적의 실행 계획을 수립하는 작업이 필요하다.

## 쿼리 실행 절차

1. 사용자로부터 요청된 SQL 문장을 잘게 쪼개서 MySQL 서버가 이해할 수 있는 수준으로 분리(파스 트리)한다.

    - SQL 파싱, MySQL 서버의 SQL 파서라는 모듈로 처리한다

    - SQL 문장이 문법적으로 잘못됐다면 이 단계에서 걸러진다.

    - SQL 파스 트리가 만들어진다.

    - MySQL 서버는 SQL문장이 아니라 SQL 파스 트리를 이용해 쿼리를 실행한다.

2. SQL의 파싱 정보를 확인하면서 어떤 테이블부터 읽고 어떤 인덱스를 이용해 테이블을 읽을지 선택한다.

    - SQL 파스 트리를 참조하면서 처리한다.

        - 불필요한 조건 제거 및 복잡한 연산의 단순화

        - 여러 테이블의 조인이 있는 경우 어떤 순서로 테이블을 읽을지 결정

        - 각 테이블에 사용된 조건과 인덱스 통계 정보를 이용해 사용할 인덱스를 결정

        - 가져온 레코드들을 임시 테이블에 넣고 다시 한번 가공해야 하는지 결정

    - 최적화 및 실행 계획 수립 단계, 두 번째 단계가 완료되면 "실행 계획"이 만들어 진다.

3. 두 번째 단계에서 결정된 테이블의 읽기 순서나 선택된 인덱스를 이용해 스토리지 엔진으로부터 데이터를 가져온다.

    - 수립된 실행 계획대로 스토리지 엔진에 레코드를 읽어오도록 요청한다.

    - MySQL 엔진에서는 스톹리지 엔진으로부터 받은 레코드를 조인하거나 정렬하는 작업을 수행한다.

## 비용 기반 최적화

-   쿼리를 처리하기 위한 여러가지 방법을 만들고, 각 단위 작업의 비용 정보와 대상 테이블의 예측된 통계 정보를 이용해 실행 계획별 비용을 산출한다.

-   산출된 방법별로 비용이 최소로 소요되는 처리 방식을 선택해 최종적으로 쿼리를 실행한다.
