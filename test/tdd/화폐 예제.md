<!-- @format -->

# 화폐 예제

## 할 일 목록

> 어떤 테스트들이 있어야 보고서에 제대로 계산 되도록 하는 코드가 완성됐다는걸 확신할 수 있을까?

```
  - 통화가 다른 두 금액을 더해서 주어진 환율에 맞게 변한 금액을 결과로 얻을 수 있어야 한다.

  - 어떤 금액(주가)을 어떤 수(주식의 수)에 곱한 금액을 결과로 얻을 수 있어야 한다.
```

-   어떤 일을 해야 하는지 알려주고, 지금 하는 일에 집중할 수 있도록 도와주며, 언제 일이 다 끝나는지 알려줄 수 있게끔 할일 목록을 작성한다.

-   또 다른 테스트가 생각나면 할 일 목록에 새로운 항목을 추가한다.

## 곱하기 먼저

-   할 일 목록(두 번째 곱하기)에 곱하기를 테스트 한다.

-   객체를 만들면서 시작하는게 아니라 테스트를 먼저 만들어야 한다.(이 사실을 항상 되뇌어야 한다.)

-   작은 것 부터 시작한다. (할 일 목록에서 첫번째보다 두번째가 더 쉬워 보이므로 먼저한다.)

-   오퍼레이션이 외부에서 어떤 식으로 보일지에 대한 이야기를 테스트 코드에 적어야 한다.

```
    describe("times") {
        context("입력값이 정수인 경우") {
            it("dollar의 amount가 입력 값 만큼 곱해진다.") {
                val sut = Dollar(5)

                sut.times(2)

                sut.amount shouldBe 10
            }
        }
    }
```

-   부작용이 있을 수 있고, 금액을 계산하는데 정수형을 사용한다. (작은 단계로 시작하는 것 뿐이다.)

-   문제들을 적어놓고 계속 진행한다.

-   현재 실패하는 테스트가 주어진 상태고 최대한 빨리 초록막대를 봐야한다.

```
문제
- Dollar 부작용?
- Money 반올림?
```

-   위의 테스트는 컴파일 조차 되지 않는다.

-   네 개의 컴파일 에러가 있다.

    1. Dollar 클래스가 없다.
    2. 생성자가 없다.
    3. times(int) 메서드가 없다.
    4. amount 필드가 없다.

-   위 문제들을 해결해서 컴파일이 되도록 한다.

```
class Dollar(amount: Int) {

    var amount = amount

    fun times(multiplier: Int) {
    }
}
```

-   위의 Dollar클래스를 추가 후 테스트를 실행하면 컴파일 되는 실패하는 테스트가 된다. (빨간 막대)

-   이제 문제는 '다중 통화 구현'에서 '이 테스트를 통과시킨 후 나머지 테스트들도 통과시키기'로 변형되었다. 훨씬 간단하고, 범위도 줄었다.

-   당장의 목표는 테스트를 통과하는 것 뿐이다.

```
var amount = 10
```

-   테스트가 성공한다.
-   다음과 같은 주기로 계속 진행한다.

```
TDD 주기
1. 작은 테스트를 하나 추가한다.
2. 모든 테스트를 실행해서 테스트가 실패하는 것을 확인한다.
3. 수정한다.
4. 모든 테스트를 실행해서 테스트가 성공하는 것을 확인한다.
5. 중복을 제거하기 위해 리팩토링을 한다.
```

> One and only once: 필요한 것을 하되 단 한 번만 하라

-   주기의 1번부터 4번 까지 수행했다. 중복을 제거 해야한다.

-   중복은 테스트에 있는 데이터와 코드에 있는 데이터 사이에 존재한다.

```
var amount = 10 를
var amount = 5 * 2로 바꾸면 테스트 코드(생성자 5, 메서드 인자 2)와 중복이 발생하게 된다.
```

-   한번에 중복을 제거할 수 있는 방법은 없다.
-   일단 객체의 초기화 단계에 있는 코드를 times() 메서드 안으로 옮긴다.

```
    fun times(multiplier: Int) {
        amount = 5 * 2
    }
```

-   테스트는 성공한다.

> TDD의 핵심은 이와 같은 작은 단계를 밟을 능력을 갖추어야 한다는 것이다.
>
> 항상 이런식의 코딩을 하진 않는다. 일이 꼬이기 시작하면 한다.
> 작은 단계로 작업하는 방법을 배우면, 저절로 적절한 크기의 단계로 작업할 수 있게 될 것이다.

-   이제 중복(5와 2)을 제거해야 한다.

-   5는 생성자에서 넘어오는 값이니 amount변수에 생성자로 넘어오는 값을 저장한다.

```
var amount = amount
```

-   amount의 변경으로 times()메서드도 다음과 같이 수정할 수 있다.

```
    fun times(multiplier: Int) {
        amount = amount * 2
    }
```

-   2의 중복을 제거할 차례다.

-   2는 인자 multiplier의 값이므로 multiplier 인자로 2를 대체한다.

```
    fun times(multiplier: Int) {
        amount *= multiplier
    }
```

-   중복 제거를 위해 \*= 연산자를 사용한다.

```
    fun times(multiplier: Int) {
        amount *= multiplier
    }
```

-   코틀린 생성자를 이용해 필트 중복을 제거한다.

```
var amount = amount // 제거
class Dollar(var amount: Int) // 변수 키워드 추가(var)
```

-   테스트는 성공한다.

```
지금까지 한 작업

- 작업해야 할 테스트 목록을 만들었다.

- 오퍼레이션이 외부에서 어떻게 보이길 원하는지 말해주는 이야기를 코드로 표현했다.

- 스텁 구현을 통해 테스트를 컴파일 했다.

- 억지로 테스트를 통과시켰다.

- 돌아가는 코드에서 상수를 변수로 변경하여 점진적으로 일반화했다.

- 새로운 할일들을 한번에 처리하는 대신 할 일 목록에 추가하고 넘어갔다.
```
